#!/bin/dash

LOG_TAG="[Restart Macbook TouchBarServer]"

# オプション解析
for arg in "$@"
do
    case $arg in
        --version)
            echo "1.0.0"
            exit 0
            ;;
        *)
            # 未知のオプションに対する処理
            logger -s "$LOG_TAG Error: Unknown option $arg"
            exit 201
            ;;
    esac
done

# ルート権限を持っていなければエラー
if [ "$(id -u)" -ne 0 ]; then
    logger -s "$LOG_TAG Error: This script must be run as root"
    exit 103
fi

# TouchBarServerプロセスのプロセスIDを取得
pid=$(pgrep TouchBarServer)

# TouchBarServerが見つからない場合
if [ -z "$pid" ]; then
    logger -s "$LOG_TAG TouchBarServer not found."
    exit 101
fi

# プロセスが存在する場合、強制終了
echo "$LOG_TAG Killing TouchBarServer with PID $pid"
logger "$LOG_TAG Killing TouchBarServer with PID $pid"
kill -TERM $pid

# killコマンドの結果をチェック
if [ $? -ne 0 ]; then
    logger -s "$LOG_TAG Failed to kill TouchBarServer."
    exit 102
fi

echo "$LOG_TAG Successfully killed TouchBarServer."
logger "$LOG_TAG Successfully killed TouchBarServer."
